@if(!dashboardloading){<app-drawer
  [userprojects]="UserProjects.length"
  [communityprojects]="CommunityProjects.length"
></app-drawer>
<app-mutli-step-loader
  [loadingStates]="loadingStates"
  [duration]="2000"
  [loop]="false"
></app-mutli-step-loader>
<app-toastr></app-toastr>
<div
  #heroSection
  class="relative flex min-h-screen text-white transition-all duration-300 pb-20 bg-radial from-neutral-500 to-p5/50"
  [ngClass]="{
    'lg:w-[calc(100vw-320px)] lg:translate-x-80': drawer.isOpen(),
    'w-screen': !drawer.isOpen()
  }"
>
  <div class="flex min-w-0 flex-1 flex-col">
    <main class="w-full pb-6">
      <section class="min-h-100 overflow-hidden text-white shadow-lg w-full">
        <div class="bg-black flex h-16 items-center justify-between px-6">
          <div class="flex items-center gap-3">
            @if(!(this.drawer.isOpen())){
            <img
              (click)="drawer.open()"
              src="/icons/sidebar.svg"
              alt=""
              class="hidden md:block cursor-pointer size-8"
            />
            }
            <a href="/"
              ><img src="/Logo.png" alt="" class="size-8 block md:hidden"
            /></a>
            <h1 class="text-lg text-white font-semibold tracking-tight">
              Jett Dashboard
            </h1>
          </div>
          <div class="flex items-center gap-3">
            <button
              class="rounded-full md:rounded-2xl inline-flex items-center cursor-pointer gap-2 bg-white px-2 md:px-4 py-2 text-sm font-medium text-black shadow-sm hover:bg-neutral-300"
              (click)="createProject()"
            >
              <span class="flex h-6 w-6 items-center justify-center">
                <svg
                  class="h-6 w-6 md:h-4 md:w-4"
                  viewBox="0 0 24 24"
                  fill="none"
                  aria-hidden="true"
                >
                  <path
                    d="M12 5v14M5 12h14"
                    stroke="currentColor"
                    stroke-width="1.8"
                    stroke-linecap="round"
                  />
                </svg>
              </span>
              <div class="hidden md:block">New Project</div>
            </button>
            <button (click)="opendropdown()" class="dropdown block md:hidden">
              <img
                [src]="user.user?.avatar || '/icons/avatarw.svg'"
                alt="no Image"
                class="size-10 cursor-pointer ring-2 ring-logo rounded-full"
              />
              @if(dropdownOpen){
              <div
                class="dropdown flex flex-col justify-around z-20 overflow-hidden absolute right-8 top-18 bg-neutral-300 text-neutral-800 text-left shadow-lg rounded-lg divide-y divide-neutral-500"
              >
                <a href="/" class="py-2 px-4">Home</a>
                <div
                  (click)="logout(); closedropdown()"
                  class="py-2 px-4 active:bg-gray-100 active:text-red-500"
                >
                  Logout
                </div>
              </div>
              }
            </button>
          </div>
        </div>
        <app-wavy-hero
          [containerRef]="heroSection"
          [colors]="['#38bdf8', '#818cf8', '#c084fc', '#e879f9', '#22d3ee']"
          [waveWidth]="50"
          [blur]="10"
          speed="fast"
          [waveOpacity]="0.5"
          [containerClass]="'h-full'"
          [contentClass]="''"
        >
          <div
            class="flex flex-col gap-2 h-full bg-transparent justify-center px-5 py-10 w-full"
          >
            <h2
              class="mt-4 text-balance text-3xl font-bold leading-tight md:text-4xl lg:text-5xl text-p6"
            >
              Hello {{ user.user.name || user.user.username }}, Welcome to Jett
            </h2>
            <p class="mt-4 max-w-3xl text-pretty text-white/90 md:text-lg">
              Unleash your creativity with our comprehensive suite of
              professional design tools and resources.
            </p>
            <div class="mt-6 flex flex-wrap gap-3">
              <button
                (click)="createProject()"
                class="inline-flex cursor-pointer items-center rounded-2xl bg-white px-5 py-2 text-sm font-medium text-gray-900 shadow-sm hover:bg-gray-400 hover:text-gray-50"
              >
                Start Deploying
              </button>
              <a
                [routerLink]="['/dashboard']"
                fragment="community"
                class="cursor-pointer inline-flex items-center rounded-2xl bg-black/20 px-5 py-2 text-sm font-medium text-white ring-1 ring-white/40 hover:bg-white/10"
              >
                Our Community
              </a>
            </div>
          </div>
        </app-wavy-hero>
      </section>
      <section
        id="projects"
        aria-labelledby="recent-apps-title"
        class="px-8 pt-10 mx-auto"
      >
        <header class="mb-4 flex items-center gap-2">
          <h2
            id="recent-apps-title"
            class="text-2xl font-semibold text-white text-balance"
            aria
          >
            Your Projects
          </h2>
          <div class="tooltip relative group">
            <img
              (click)="opentooltip()"
              src="/icons/info.svg"
              alt="Info"
              class="size-6 cursor-pointer translate-y-0.5"
            />
            @if(tooltipOpen){
            <span
              class="absolute text-center left-1/2 -translate-x-2/3 sm:translate-0 w-[200px] mt-2 rounded-md bg-black text-white text-sm px-2 py-1 shadow-lg"
            >
              If you have already deployed a project and it does not show, try
              refreshing the page. </span
            >}
          </div>
        </header>
        @if(UserProjects.length == 0){
        <h2 class="text-neutral-500 font-semibold text-2xl mb-4 pl-8">
          You have nothing to show.
        </h2>
        <div class="flex items-center justify-start pl-8">
          <button
            class="inline-flex items-center cursor-pointer gap-2 rounded-2xl bg-white px-4 py-2 text-sm font-medium text-black shadow-sm hover:bg-neutral-300"
            (click)="createProject()"
          >
            <span class="flex h-6 w-6 items-center justify-center">
              <svg
                class="h-4 w-4"
                viewBox="0 0 24 24"
                fill="none"
                aria-hidden="true"
              >
                <path
                  d="M12 5v14M5 12h14"
                  stroke="currentColor"
                  stroke-width="1.8"
                  stroke-linecap="round"
                />
              </svg>
            </span>
            New Project
          </button>
        </div>
        }
        <div
          class="media grid gap-6 grid-cols-1 sm680:grid-cols-2 lg:grid-cols-3"
        >
          @for(project of UserProjects ; track project.deploy_id){
          <app-card [project]="project">
            <article
              class="group rounded-3xl h-64 xs:h-62 border border-gray-200 bg-white p-5 md:p-6 shadow-sm transition-shadow hover:shadow-md flex flex-col justify-between"
              aria-label="Project card"
            >
              <header class="flex items-start justify-between gap-3">
                <div class="flex flex-col items-start gap-2">
                  <div class="min-w-0">
                    <a
                      href="{{ project.deployed_url }}"
                      target="_blank"
                      class="text-sm xs:text-base md:text-lg font-semibold text-gray-900 text-pretty"
                    >
                      {{ project.project_name }}-{{ project.deploy_id }}
                    </a>
                  </div>
                  <div class="flex gap-2 items-center">
                    <div
                      class="w-4 h-4 rounded-full"
                      [ngClass]="{
                        'bg-yellow-400': project.status === 'uploaded',
                        'bg-orange-400': project.status === 'building',
                        'bg-green-400': project.status === 'deployed',
                        'bg-red-400': project.status === 'failed',
                        'animate-pulse':
                          project.status === 'uploaded' ||
                          project.status === 'building'
                      }"
                    ></div>
                    <div class="text-xs xs:text-sm -translate-y-0.5 text-black">
                      @switch (project.status) { @case ('uploaded') { Uploaded }
                      @case ('building') { Building... } @case ('deployed') {
                      Deployed! } @case ('failed') { Failed! } @default {
                      Unknown } }
                    </div>
                  </div>
                </div>

                <button
                  type="button"
                  class="shrink-0 inline-flex items-center rounded-full border border-gray-200 p-2 text-gray-600 hover:bg-gray-50 hover:text-gray-900 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500"
                  aria-label="Edit project name"
                >
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    class="size-4"
                    viewBox="0 0 24 24"
                    fill="none"
                    stroke="currentColor"
                    stroke-width="1.75"
                  >
                    <path d="M12 20h9"></path>
                    <path
                      d="M16.5 3.5a2.12 2.12 0 0 1 3 3L7 19l-4 1 1-4L16.5 3.5z"
                    ></path>
                  </svg>
                </button>
              </header>

              <div class="mt-4 grid grid-cols-1 sm:grid-cols-2 gap-3 md:gap-4">
                <div class="flex items-start gap-3">
                  <div
                    class="mt-0.5 rounded-lg bg-gray-100 text-gray-600 p-2"
                    aria-hidden="true"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      class="size-4"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="1.75"
                    >
                      <circle cx="12" cy="12" r="3"></circle>
                      <path d="M3 12h6M15 12h6"></path>
                    </svg>
                  </div>
                  <div class="min-w-0">
                    <p class="text-xs font-medium text-gray-500">Last commit</p>
                    <p class="text-sm text-gray-700 line-clamp-2">
                      {{ project.last_commit_message }}
                    </p>
                  </div>
                </div>

                <div class="flex items-start gap-1">
                  <div
                    class="mt-0.5 rounded-lg bg-gray-100 text-gray-600 p-2 w-[32px] h-[32px] flex items-center justify-center"
                    aria-hidden="true"
                  >
                    <svg
                      class="w-4 h-4"
                      viewBox="0 0 48 48"
                      xmlns="http://www.w3.org/2000/svg"
                      fill="#475569"
                      stroke-width="1.75"
                    >
                      <g>
                        <path
                          d="M44,9a7,7,0,1,0-9,6.7V16a6,6,0,0,1-6,6H21a10.3,10.3,0,0,0-6,2V15.7a7,7,0,1,0-4,0V32.3a7,7,0,1,0,4,0V32a6,6,0,0,1,6-6h8A10,10,0,0,0,39,16v-.3A7,7,0,0,0,44,9ZM10,9a3,3,0,0,1,6,0,3,3,0,0,1-6,0Zm6,30a3,3,0,1,1-3-3A2.9,2.9,0,0,1,16,39ZM37,12a2.9,2.9,0,0,1-3-3,3,3,0,0,1,6,0A2.9,2.9,0,0,1,37,12Z"
                        ></path>
                      </g>
                    </svg>
                  </div>
                  <div class="w-full">
                    <div
                      class="inline-flex items-center justify-start gap-2 w-full bg-white px-1 py-1.5 text-xs md:text-sm text-gray-800 font-medium"
                    >
                      <span
                        class="font-mono w-24 flex items-center justify-around"
                      >
                        {{ project.branch_name }}
                        <div class="bg-gray-400 h-5 w-1 rounded-4xl"></div>
                        {{ project.last_commit_datetime }}
                      </span>
                    </div>
                  </div>
                </div>
              </div>

              <footer
                class="mt-5 flex flex-wrap items-center justify-between gap-3"
              >
                <div class="flex items-center gap-2">
                  <a
                    class="inline-flex items-center justify-center rounded-full border border-gray-200 bg-gray-50 px-4 py-2 text-sm font-medium text-gray-900 hover:bg-gray-100"
                    href="{{ project.repo_link }}"
                    target="_blank"
                    rel="noopener noreferrer"
                  >
                    View repo
                  </a>
                  @if(project.deployed_url){
                  <a
                    href="{{ project.deployed_url }}"
                    target="_blank"
                    class="inline-flex items-center justify-center rounded-full bg-gray-900 px-4 py-2 text-sm font-semibold text-white hover:bg-gray-800 focus:outline-none focus-visible:ring-2 focus-visible:ring-indigo-500"
                  >
                    Open
                  </a>
                  }
                </div>
              </footer>
            </article>
          </app-card>
          }
        </div>
      </section>

      <section
        id="community"
        aria-labelledby="community-title"
        class="relative px-8 pt-10 mx-auto"
      >
        <header class="mb-4">
          <h2
            id="community-title"
            class="text-2xl font-semibold text-white text-balance"
          >
            Community Projects
          </h2>
        </header>

        <!-- Right Arrow -->
        <img
          src="/icons/right.svg"
          alt="scroll right"
          class="z-20 absolute top-1/2 right-10 size-8 rounded-full p-2 cursor-pointer bg-black/40"
          [class.block]="canScrollRight"
          [class.hidden]="!canScrollRight"
          (click)="scrollRight(scrollContainer)"
        />

        <!-- Left Arrow -->
        <img
          src="/icons/right.svg"
          alt="scroll left"
          class="rotate-180 z-20 absolute top-1/2 left-10 size-8 rounded-full p-2 cursor-pointer bg-black/40"
          [class.block]="canScrollLeft"
          [class.hidden]="!canScrollLeft"
          (click)="scrollLeft(scrollContainer)"
        />

        <!-- Scrollable Container -->
        <div
          #scrollContainer
          class="flex gap-6 overflow-x-auto sm:grid sm:grid-cols-2 lg:grid-cols-3 hide-scrollbar"
          (scroll)="updateScrollButtons(scrollContainer)"
        >
          @for (project of CommunityProjects; track project.deploy_id) {
          <article
            class="group min-w-[100%] sm:w-full overflow-hidden rounded-[1.5rem] border border-neutral-200 bg-white shadow-sm transition-shadow hover:shadow-md"
            aria-label="Design shot card"
          >
            <div
              (click)="followUrl(project.deployed_url)"
              class="relative h-48 xs:h-52 bg-neutral-900"
            >
              <iframe
                [src]="project.safeUrl"
                frameborder="0"
                scrolling="no"
                class="w-full h-full object-cover overflow-hidden"
              ></iframe>
            </div>

            <div class="bg-white flex justify-between items-center pr-6">
              <div class="px-5 py-4 md:px-6 md:py-5">
                <a
                  href="{{ project.deployed_url }}"
                  target="_blank"
                  class="text-base md:text-lg font-semibold leading-tight text-neutral-900 hover:underline text-pretty"
                >
                  {{ project.project_name }}
                </a>
                <p class="mt-1 text-sm text-neutral-500">
                  by {{ project.username }}
                </p>
              </div>
              <time class="text-sm text-neutral-500">
                {{ project.createdAtString }}
              </time>
            </div>
          </article>
          }
        </div>
      </section>
    </main>
  </div>
</div>
<app-mobile-nav></app-mobile-nav>
}@else {
<app-auth-callback></app-auth-callback>
}
